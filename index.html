<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3학년 1반 | 추억 저장소</title>
    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- 스타일 -->
    <link rel="stylesheet" href="style.css">
    <!-- 스크립트 -->
    <script src="config.js" defer></script>
    <script src="app.js" defer></script>
</head>
<body>
    <!-- 네비게이션 -->
    <nav class="glass-nav">
        <div class="logo" onclick="navigateTo('home')">
            <span>🏫 Class 3-1</span>
        </div>
        <ul class="nav-links">
            <li id="login-link" class="btn-signup">로그인</li>
        </ul>
    </nav>

    <!-- 메인 앱 컨테이너 -->
    <main id="app-container">
        
        <!-- =======================
             1. 메인 홈 (Home)
        ======================== -->
        <section id="home" class="page active">
            <div class="hero-header">
                <h1>반가워요! 3학년 1반</h1>
                <p>우리들의 이야기가 모이는 공간</p>
            </div>
            
            <div class="menu-grid">
                <!-- 커뮤니티 (구 '이야기 나누기') -->
                <div class="menu-card" onclick="navigateTo('community')">
                    <div class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 8h2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2v4l-4-4H9a1.99 1.99 0 0 1-2-2v-6a2 2 0 0 1 2-2g3 0 0 1 3-3h3"></path>
                        </svg>
                    </div>
                    <h3>커뮤니티</h3>
                    <p>우리반 수다방</p>
                </div>

                <!-- 학급 갤러리 (구 '사진 보러가기') -->
                <div class="menu-card" onclick="navigateTo('gallery')">
                    <div class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </div>
                    <h3>학급 갤러리</h3>
                    <p>우리의 추억들</p>
                </div>

                <!-- 오늘의 급식 -->
                <div class="menu-card" onclick="openLunchModal()">
                    <div class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                            <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                            <line x1="6" y1="1" x2="6" y2="4"></line>
                            <line x1="10" y1="1" x2="10" y2="4"></line>
                            <line x1="14" y1="1" x2="14" y2="4"></line>
                        </svg>
                    </div>
                    <h3>오늘의 급식</h3>
                    <p>맛있는 점심 메뉴</p>
                </div>

                <!-- 알림장 -->
                <div class="menu-card" onclick="navigateTo('notice')" id="notice-card">
                    <div class="red-dot" id="notice-dot"></div> <!-- 빨간 알림 점 -->
                    <div class="card-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                    </div>
                    <h3>알림장</h3>
                    <p>선생님 말씀</p>
                </div>
            </div>
        </section>

        <!-- =======================
             2. 회원가입 / 로그인
        ======================== -->
        <section id="auth" class="page">
            <div class="auth-container">
                <!-- 로그인 폼 -->
                <div id="login-view">
                    <h2 style="text-align:center; margin-bottom:20px;">로그인</h2>
                    <form id="login-form">
                        <div class="input-group">
                            <label>학번</label>
                            <input type="text" id="login-id" placeholder="예: 30101" maxlength="5">
                        </div>
                        <div class="input-group">
                            <label>비밀번호</label>
                            <input type="password" id="login-pw" placeholder="비밀번호">
                        </div>
                        <button type="submit" class="btn primary full-width">로그인</button>
                    </form>
                    <p style="text-align:center; margin-top:15px; font-size:0.9rem;">
                        아직 회원이 아니신가요? <a href="#" onclick="toggleAuthMode('signup')" style="color:var(--primary)">회원가입</a>
                    </p>
                </div>
                
                <!-- 회원가입 폼 -->
                <div id="signup-view" style="display:none;">
                    <h2 style="text-align:center; margin-bottom:20px;">회원가입 신청</h2>
                    <form id="signup-form">
                        <div class="input-group">
                            <label>이름</label>
                            <input type="text" id="signup-name" placeholder="본명 입력">
                        </div>
                        <div class="input-group">
                            <label>학번</label>
                            <input type="text" id="signup-id" placeholder="학번(4자리를 적어주세요. 예:1학년2반13번->1213)" maxlength="4">
                            <div class="error-msg" id="signup-id-error">정확한 학번을 입력해주세요!</div>
                        </div>
                        <div class="input-group">
                            <label>비밀번호</label>
                            <input type="password" id="signup-pw" placeholder="비밀번호(8자리 이상 1개이상의 특수문자 포함)">
                            <div class="error-msg" id="signup-pw-error">8자리 이상 1개이상의 특수문자 포함!</div>
                        </div>
                        <button type="submit" class="btn primary full-width">가입 신청</button>
                    </form>
                    <p style="text-align:center; margin-top:15px; font-size:0.9rem;">
                        이미 계정이 있으신가요? <a href="#" onclick="toggleAuthMode('login')" style="color:var(--primary)">로그인</a>
                    </p>
                </div>
            </div>
        </section>

        <!-- =======================
             3. 커뮤니티
        ======================== -->
        <section id="community" class="page">
            <div class="section-header">
                <h2>💬 커뮤니티</h2>
                <button id="btn-community-write" class="btn primary" style="display:none;">글쓰기</button>
            </div>
            
            <div class="lock-container">
                <div id="community-list" class="community-list blur-target">
                    <!-- 리스트 아이템들이 여기에 로드됨 -->
                </div>
                <div class="lock-overlay-msg">가입 후 확인!</div>
            </div>
        </section>

        <!-- =======================
             4. 학급 갤러리
        ======================== -->
        <section id="gallery" class="page">
            <div class="section-header">
                <h2>📷 학급 갤러리</h2>
                <button id="btn-gallery-write" class="btn primary" style="display:none;">사진 올리기</button>
            </div>

            <div class="lock-container">
                <div id="gallery-grid" class="gallery-grid blur-target">
                    <!-- 갤러리 썸네일들 -->
                </div>
                <div class="lock-overlay-msg">회원만 열람가능</div>
            </div>
        </section>

        <!-- =======================
             5. 알림장
        ======================== -->
        <section id="notice" class="page">
            <div class="section-header">
                <h2>📢 알림장</h2>
                <div style="display:flex; gap:10px;">
                    <!-- 교사 프로필 설정 (교사만 보임) -->
                    <button id="btn-notice-profile" class="btn" style="display:none; background:#eee;">프로필 설정</button>
                    <button id="btn-notice-write" class="btn primary" style="display:none;">알림 쓰기</button>
                </div>
                <input type="file" id="teacher-profile-upload" accept="image/*" style="display:none;">
            </div>

            <div class="lock-container">
                <div id="notice-container" class="notice-container blur-target">
                    <!-- 알림장 대화 내용 -->
                </div>
                <div class="lock-overlay-msg">승인 후 열람가능</div>
            </div>
        </section>

    </main>

    <!-- =======================
         모달들 (Modals)
    ======================== -->

    <!-- A. 급식 모달 -->
    <div id="lunch-modal" class="modal">
        <div class="modal-content" style="text-align:center;">
            <span class="close-modal" onclick="closeModal('lunch-modal')">&times;</span>
            <h3 style="margin-bottom:20px; font-size:1.5rem;">🍱 오늘의 급식</h3>
            <div id="lunch-content" style="font-size:1.1rem; line-height:1.8; margin-bottom:20px; white-space:pre-line;">
                로딩 중...
            </div>
            <button class="btn primary full-width" onclick="closeModal('lunch-modal')">잘 먹겠습니다!</button>
        </div>
    </div>

    <!-- B. 글쓰기 모달 (커뮤니티) -->
    <div id="community-write-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('community-write-modal')">&times;</span>
            <h3>글쓰기</h3>
            <div style="margin-top:20px;">
                <div class="input-group">
                    <input type="text" id="comm-title" placeholder="제목 (30바이트 이내)">
                    <div id="comm-title-byte" class="byte-counter">0/30</div>
                </div>
                <div class="input-group">
                    <textarea id="comm-content" class="modal-input" style="height:200px; resize:none;" placeholder="내용 (3000바이트 이내)"></textarea>
                    <div id="comm-content-byte" class="byte-counter">0/3000</div>
                </div>
                <button class="btn primary full-width" onclick="submitCommunityPost()">등록하기</button>
            </div>
        </div>
    </div>

    <!-- C. 사진 올리기 모달 (갤러리) -->
    <div id="gallery-write-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('gallery-write-modal')">&times;</span>
            <h3>사진 올리기</h3>
            <div style="margin-top:20px;">
                <div class="input-group">
                    <label>작성자</label>
                    <input type="text" id="gallery-author" readonly style="background:#f5f5f5;">
                </div>
                <div class="input-group">
                    <label>제목</label>
                    <input type="text" id="gallery-title" placeholder="제목">
                    <div id="gallery-title-byte" class="byte-counter">0/30</div>
                </div>
                <div class="input-group">
                    <label>사진 선택</label>
                    <input type="file" id="gallery-file" accept="image/*">
                </div>
                <button class="btn primary full-width" onclick="submitGalleryPost()">올리기</button>
            </div>
        </div>
    </div>

    <!-- D. 알림 쓰기 모달 (선생님) -->
    <div id="notice-write-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('notice-write-modal')">&times;</span>
            <h3>알림장 쓰기</h3>
            <div style="margin-top:20px;">
                <div class="input-group">
                    <textarea id="notice-content" class="modal-input" style="height:150px;" placeholder="알림 내용"></textarea>
                </div>
                <div class="input-group">
                    <label>첨부파일 (사진/텍스트, 최대 20MB)</label>
                    <input type="file" id="notice-file">
                </div>
                <button class="btn primary full-width" onclick="submitNoticePost()">전송</button>
            </div>
        </div>
    </div>

    <!-- E. 이미지 확대 모달 -->
    <div id="image-viewer-modal" class="modal">
        <div class="modal-content large-viewer">
            <div class="large-viewer-header">
                <span class="close-modal white-x" onclick="closeModal('image-viewer-modal')">&times;</span>
            </div>
            <div class="large-viewer-body">
                <img id="viewer-img" src="" alt="Full Size">
            </div>
        </div>
    </div>

    <!-- F. 커뮤니티 글 상세 모달 -->
    <div id="post-detail-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('post-detail-modal')">&times;</span>
            <h3 id="detail-title" style="margin-bottom:5px;">제목</h3>
            <div id="detail-meta" style="font-size:0.8rem; color:#888; margin-bottom:20px;">작성자 | 날짜</div>
            <div id="detail-body" style="white-space:pre-wrap; min-height:100px;">내용</div>
        </div>
    </div>

</body>
</html>