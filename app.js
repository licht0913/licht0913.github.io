const pages = document.querySelectorAll(".page"), navLinks = document.querySelectorAll(".nav-links li"), mobileMenuBtn = document.querySelector(".mobile-menu-btn"), navLinksContainer = document.querySelector(".nav-links"), modal = document.getElementById("write-modal"), toast = document.getElementById("toast"), ICONS = { user: '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>' }; let currentPosts = []; function initNavigation() { navLinks.forEach(e => { e.addEventListener("click", () => { let t = e.getAttribute("data-target"); navigateTo(t), window.innerWidth <= 768 && navLinksContainer.classList.remove("active") }) }), mobileMenuBtn.addEventListener("click", () => { navLinksContainer.classList.toggle("active") }), document.querySelector(".close-modal").addEventListener("click", () => { modal.classList.remove("show") }), window.addEventListener("click", e => { e.target === modal && modal.classList.remove("show") }), document.getElementById("signup-form").addEventListener("submit", e => { e.preventDefault(), showToast("가입 신청 완료!"), e.target.reset() }), document.getElementById("write-form").addEventListener("submit", async e => { e.preventDefault(); let t = document.getElementById("post-author").value, n = document.getElementById("post-title").value, o = document.getElementById("post-content").value; await addPost(n, o, t), modal.classList.remove("show"), showToast("게시글이 등록되었습니다!"), e.target.reset() }) } function navigateTo(e) { navLinks.forEach(t => { t.getAttribute("data-target") === e ? t.classList.add("active") : t.classList.remove("active") }), pages.forEach(t => { t.id === e ? t.classList.add("active") : t.classList.remove("active") }), window.scrollTo(0, 0) } function getProp(e, t) { for (let n of t) if (e[n]) { if (e[n].title && e[n].title[0]) return e[n].title[0].plain_text; if (e[n].rich_text && e[n].rich_text[0]) return e[n].rich_text[0].plain_text; if (e[n].date) return e[n].date.start } return "" } async function loadContent() { try { const e = await fetch(CONFIG.API_URL), t = await e.json(); if (t.error) throw new Error(t.error); currentPosts = t.map(e => ({ id: e.id, title: getProp(e.properties || e, ["Title", "title", "제목"]) || "제목 없음", content: getProp(e.properties || e, ["Content", "content", "내용"]) || "", author: getProp(e.properties || e, ["Author", "author", "글쓴이", "작성자"]) || "익명", date: getProp(e.properties || e, ["Date", "date", "날짜"]) || new Date().toISOString().split("T")[0] })), renderPosts() } catch (e) { console.error(e), loadMockCommunity() } loadMockGallery() } function loadMockGallery() { let e = document.getElementById("gallery-container"); e.innerHTML = "", [{ url: "https://picsum.photos/300/300?random=1", title: "체육대회" }, { url: "https://picsum.photos/300/300?random=2", title: "현장학습" }, { url: "https://picsum.photos/300/300?random=3", title: "급식실" }, { url: "https://picsum.photos/300/300?random=4", title: "쉬는 시간" }, { url: "https://picsum.photos/300/300?random=5", title: "과학실" }, { url: "https://picsum.photos/300/300?random=6", title: "방과후" }].forEach(t => { let n = document.createElement("div"); n.className = "gallery-item", n.innerHTML = `<img src="${t.url}" alt="${t.title}" loading="lazy"><div class="gallery-overlay"><h4>${t.title}</h4></div>`, e.appendChild(n) }) } function loadMockCommunity() { let e = document.getElementById("community-container"); 0 === currentPosts.length && (currentPosts = [{ id: 1, title: "게시글을 불러오는 중...", author: "시스템", content: "잠시만 기다려주세요." }]), renderPosts() } function renderPosts() { let e = document.getElementById("community-container"); if (e.innerHTML = "", 0 === currentPosts.length) { e.innerHTML = '<div class="empty-state"><p>게시글이 없습니다. 첫 글을 남겨보세요!</p></div>'; return } currentPosts.forEach(t => { let n = document.createElement("div"); n.className = "community-item", n.innerHTML = `<h4>${t.title}</h4><div class="meta"><span>${ICONS.user} ${t.author}</span> &bull; <span>${t.date}</span></div><p style="margin-top: 10px; color: var(--text-light); font-size: 0.95rem;">${t.content}</p>`, e.appendChild(n) }) } async function addPost(e, t, n) { let o = { id: "temp-" + Date.now(), title: e, content: t, author: n, date: (new Date).toISOString().split("T")[0] }; currentPosts.unshift(o), renderPosts(); try { await fetch(CONFIG.API_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "text/plain" }, body: JSON.stringify({ Title: e, Content: t, Author: n }) }), await new Promise(e => setTimeout(e, 1500)) } catch (e) { console.error(e) } } document.addEventListener("DOMContentLoaded", () => { initNavigation(), loadContent() });
