const pages = document.querySelectorAll('.page'), navLinks = document.querySelectorAll('.nav-links li'), mobileMenuBtn = document.querySelector('.mobile-menu-btn'), navLinksContainer = document.querySelector('.nav-links'), modal = document.getElementById('write-modal'), toast = document.getElementById('toast'), ICONS = { user: '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>' }; let currentPosts = []; document.addEventListener('DOMContentLoaded', () => { initNavigation(); loadContent() }); function initNavigation() { navLinks.forEach(e => { e.addEventListener('click', () => { let t = e.getAttribute('data-target'); navigateTo(t), window.innerWidth <= 768 && navLinksContainer.classList.remove('active') }) }), mobileMenuBtn.addEventListener('click', () => { navLinksContainer.classList.toggle('active') }), document.querySelector('.close-modal').addEventListener('click', () => { modal.classList.remove('show') }), window.addEventListener('click', e => { e.target === modal && modal.classList.remove('show') }), document.getElementById('signup-form').addEventListener('submit', e => { e.preventDefault(), showToast('가입 신청 완료!'), e.target.reset() }), document.getElementById('write-form').addEventListener('submit', async e => { e.preventDefault(); let t = e.target.querySelector('input').value, n = e.target.querySelector('textarea').value; await addPost(t, n), modal.classList.remove('show'), showToast('게시글 등록 시도 중...'), e.target.reset() }) } function navigateTo(e) { navLinks.forEach(t => { t.getAttribute('data-target') === e ? t.classList.add('active') : t.classList.remove('active') }), pages.forEach(t => { t.id === e ? t.classList.add('active') : t.classList.remove('active') }), window.scrollTo(0, 0) } async function loadContent() { console.log("Loading content from:", CONFIG.API_URL); try { const e = await fetch(CONFIG.API_URL); if (!e.ok) throw new Error(`HTTP error! status: ${e.status}`); const t = await e.json(); console.log("Data received:", t); currentPosts = t.results.map(e => ({ id: e.id, title: e.properties.Title ? e.properties.Title.title[0]?.plain_text : e.properties["제목"]?.title[0]?.plain_text || "제목 없음", content: e.properties.Content ? e.properties.Content.rich_text[0]?.plain_text : e.properties["내용"]?.rich_text[0]?.plain_text || "", author: e.properties.Author ? e.properties.Author.rich_text[0]?.plain_text : e.properties["글쓴이"]?.rich_text[0]?.plain_text || "익명", date: e.properties.Date ? e.properties.Date.date?.start : e.properties["날짜"]?.date?.start || new Date().toISOString().split('T')[0] })), renderPosts() } catch (e) { console.error("Load Error:", e); let errDiv = document.getElementById('community-container'); errDiv.innerHTML = `<div class="empty-state" style="color:red"><p>데이터 불러오기 실패!</p><small>${e.message}</small></div>`; loadMockGallery() } } function loadMockGallery() { let e = document.getElementById('gallery-container'); e.innerHTML = '';[{ url: 'https://picsum.photos/300/300?random=1', title: '체육대회' }, { url: 'https://picsum.photos/300/300?random=2', title: '현장학습' }, { url: 'https://picsum.photos/300/300?random=3', title: '급식실' }, { url: 'https://picsum.photos/300/300?random=4', title: '쉬는 시간' }, { url: 'https://picsum.photos/300/300?random=5', title: '과학실' }, { url: 'https://picsum.photos/300/300?random=6', title: '방과후' }].forEach(t => { let n = document.createElement('div'); n.className = 'gallery-item', n.innerHTML = `<img src="${t.url}" alt="${t.title}" loading="lazy"><div class="gallery-overlay"><h4>${t.title}</h4></div>`, e.appendChild(n) }) } function loadMockCommunity() {/*Deprecated in debug mode*/ } function renderPosts() { let e = document.getElementById('community-container'); if (e.innerHTML = '', 0 === currentPosts.length) { e.innerHTML = '<div class="empty-state"><p>게시글이 없습니다.</p></div>'; return } currentPosts.forEach(t => { let n = document.createElement('div'); n.className = 'community-item', n.innerHTML = `<h4>${t.title}</h4><div class="meta"><span>${ICONS.user} ${t.author}</span> &bull; <span>${t.date}</span></div><p style="margin-top: 10px; color: var(--text-light); font-size: 0.95rem;">${t.content}</p>`, e.appendChild(n) }) } async function addPost(e, t) { console.log("Posting to:", CONFIG.API_URL); try { let n = { Title: e, Content: t, Author: "익명", Date: new Date().toISOString().split('T')[0] }; let res = await fetch(CONFIG.API_URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(n) }); if (!res.ok) { let errText = await res.text(); throw new Error(`Write failed: ${res.status} ${errText}`); } await loadContent() } catch (e) { console.error("Write Error:", e); alert("글쓰기 실패: " + e.message) } } function openWriteModal() { modal.classList.add('show') } function showToast(e) { let t = document.getElementById('toast-message'); t.textContent = e, toast.classList.add('show'), setTimeout(() => { toast.classList.remove('show') }, 3e3) }
